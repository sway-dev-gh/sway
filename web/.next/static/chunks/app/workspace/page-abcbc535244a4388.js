(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[221],{9144:function(e,t,s){Promise.resolve().then(s.bind(s,661))},661:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N}});var a=s(7437),n=s(2265),o=s(9376),r=s(4147);class i{async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="".concat(this.baseUrl).concat(e),a={headers:{"Content-Type":"application/json",...t.headers},...t},n=localStorage.getItem("token");n&&(a.headers.Authorization="Bearer ".concat(n));try{let e=await fetch(s,a),t=await e.json();if(!e.ok){let s=Error(t.error||"HTTP ".concat(e.status));throw s.status=e.status,s.data=t,s}return t}catch(e){throw console.error("API Request failed:",e),e}}async login(e,t){return this.request("/api/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})})}async signup(e,t,s){return this.request("/api/auth/signup",{method:"POST",body:JSON.stringify({name:e,email:t,password:s})})}async logout(){return this.request("/api/auth/logout",{method:"POST"})}async getCurrentUser(){return this.request("/api/auth/me")}async getProjects(){return this.request("/api/projects")}async createProject(e){return this.request("/api/projects",{method:"POST",body:JSON.stringify(e)})}async updateProject(e,t){return this.request("/api/projects/".concat(e),{method:"PUT",body:JSON.stringify(t)})}async deleteProject(e){return this.request("/api/projects/".concat(e),{method:"DELETE"})}async getProjectFiles(e){return this.request("/api/projects/".concat(e,"/files"))}async uploadFile(e,t){return this.request("/api/projects/".concat(e,"/files"),{method:"POST",headers:{},body:t})}async updateFile(e,t){return this.request("/api/files/".concat(e),{method:"PUT",body:JSON.stringify(t)})}async deleteFile(e){return this.request("/api/files/".concat(e),{method:"DELETE"})}async getRequests(e){return this.request("/api/projects/".concat(e,"/requests"))}async createRequest(e,t){return this.request("/api/projects/".concat(e,"/requests"),{method:"POST",body:JSON.stringify(t)})}async updateRequestStatus(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return this.request("/api/requests/".concat(e,"/status"),{method:"PUT",body:JSON.stringify({status:t,comments:s})})}async addComment(e,t){return this.request("/api/requests/".concat(e,"/comments"),{method:"POST",body:JSON.stringify({comment:t})})}async getComments(e){return this.request("/api/requests/".concat(e,"/comments"))}async getProjectWorkflow(e){return this.request("/api/workflow/projects/".concat(e))}async uploadFileWithWorkflow(e,t){return this.request("/api/workflow/projects/".concat(e,"/files"),{method:"POST",headers:{},body:t})}async getSection(e){return this.request("/api/workflow/sections/".concat(e))}async submitSectionReview(e,t){return this.request("/api/workflow/sections/".concat(e,"/review"),{method:"POST",body:JSON.stringify(t)})}async addSectionComment(e,t){return this.request("/api/workflow/sections/".concat(e,"/comments"),{method:"POST",body:JSON.stringify(t)})}async getSectionComments(e){return this.request("/api/workflow/sections/".concat(e,"/comments"))}async resolveSectionComment(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return this.request("/api/workflow/comments/".concat(e,"/resolve"),{method:"PUT",body:JSON.stringify({resolved:t})})}async createFileVersion(e,t){return this.request("/api/workflow/files/".concat(e,"/version"),{method:"POST",body:JSON.stringify(t)})}async getFileVersions(e){return this.request("/api/workflow/files/".concat(e,"/versions"))}async transitionWorkflowState(e,t){return this.request("/api/workflow/files/".concat(e,"/state"),{method:"POST",body:JSON.stringify(t)})}async getWorkflowStateHistory(e){return this.request("/api/workflow/files/".concat(e,"/state-history"))}async requestSectionEdit(e,t){return this.request("/api/workflow/sections/".concat(e,"/edit-requests"),{method:"POST",body:JSON.stringify(t)})}async getSectionEditRequests(e){return this.request("/api/workflow/sections/".concat(e,"/edit-requests"))}async updateEditRequestStatus(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("/api/workflow/edit-requests/".concat(e,"/status"),{method:"PUT",body:JSON.stringify({status:t,...s})})}async getMyEditRequests(e){return this.request("/api/workflow/projects/".concat(e,"/edit-requests"))}async generateExternalAccessToken(e){return this.request("/api/workflow/external-access",{method:"POST",body:JSON.stringify(e)})}async validateExternalToken(e){return this.request("/api/workflow/external-access/validate",{method:"POST",body:JSON.stringify({token:e})})}async getCollaborations(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams(e);return this.request("/api/collaborations?".concat(t))}async createCollaboration(e){return this.request("/api/collaborations",{method:"POST",body:JSON.stringify(e)})}async updateCollaboration(e,t){return this.request("/api/collaborations/".concat(e),{method:"PATCH",body:JSON.stringify(t)})}async deleteCollaboration(e){return this.request("/api/collaborations/".concat(e),{method:"DELETE"})}async getCollaborationDetails(e){return this.request("/api/collaborations/".concat(e))}async getProjectActivity(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=new URLSearchParams(t);return this.request("/api/activity/projects/".concat(e,"?").concat(s))}async getUserActivity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams(e);return this.request("/api/activity/user?".concat(t))}async createGuestSession(e){return this.request("/api/guest/create",{method:"POST",body:JSON.stringify({displayName:e})})}async convertGuestToUser(e,t,s){return this.request("/api/guest/convert",{method:"POST",body:JSON.stringify({email:e,password:t,name:s})})}async getGuestInfo(){return this.request("/api/guest/me")}async updateGuestSession(e){return this.request("/api/guest/update",{method:"PUT",body:JSON.stringify(e)})}async healthCheck(){return this.request("/health")}constructor(){this.baseUrl="https://api.swayfiles.com"}}let c=new i,l=(0,n.createContext)(),d={DRAFT:"draft",UNDER_REVIEW:"under_review",CHANGES_REQUESTED:"changes_requested",APPROVED:"approved",DELIVERED:"delivered"},u={isAuthenticated:!1,user:null,token:localStorage.getItem("token"),isGuest:!1,guestName:null,guestWorkspaceId:null,currentWorkspace:null,workspaces:[],files:[],sections:{},comments:{},reviews:{},collaborators:[],activities:[],selectedFile:null,selectedSection:null,focusedView:!1,viewMode:"workspace",showPricingModal:!1,confirmDialog:{isOpen:!1,title:"",message:"",confirmText:"OK",cancelText:"Cancel",confirmButtonColor:"#ef4444",onConfirm:null,onCancel:null},isLoading:!1,error:null},m={LOGIN_SUCCESS:"LOGIN_SUCCESS",LOGOUT:"LOGOUT",SET_LOADING:"SET_LOADING",SET_ERROR:"SET_ERROR",LOAD_WORKSPACES:"LOAD_WORKSPACES",CREATE_WORKSPACE:"CREATE_WORKSPACE",SELECT_WORKSPACE:"SELECT_WORKSPACE",LOAD_FILES:"LOAD_FILES",ADD_FILE:"ADD_FILE",SELECT_FILE:"SELECT_FILE",ADD_SECTION:"ADD_SECTION",UPDATE_SECTION:"UPDATE_SECTION",REORDER_SECTIONS:"REORDER_SECTIONS",ADD_COMMENT:"ADD_COMMENT",UPDATE_WORKFLOW_STATE:"UPDATE_WORKFLOW_STATE",ADD_ACTIVITY:"ADD_ACTIVITY",TOGGLE_FOCUSED_VIEW:"TOGGLE_FOCUSED_VIEW",SET_VIEW_MODE:"SET_VIEW_MODE",DELETE_FILE:"DELETE_FILE",DELETE_WORKSPACE:"DELETE_WORKSPACE",GUEST_JOIN:"GUEST_JOIN",GUEST_LOGOUT:"GUEST_LOGOUT",SHOW_PRICING_MODAL:"SHOW_PRICING_MODAL",HIDE_PRICING_MODAL:"HIDE_PRICING_MODAL",SHOW_CONFIRM_DIALOG:"SHOW_CONFIRM_DIALOG",HIDE_CONFIRM_DIALOG:"HIDE_CONFIRM_DIALOG"};function p(e,t){var s,a,n,o,i,c,l;switch(t.type){case m.LOGIN_SUCCESS:return{...e,isAuthenticated:!0,user:t.payload.user,token:t.payload.token,isLoading:!1,error:null};case m.LOGOUT:return localStorage.removeItem("token"),{...e,isAuthenticated:!1,user:null,token:null,currentWorkspace:null,workspaces:[],files:[],sections:{},comments:{},selectedFile:null,selectedSection:null,activities:[],error:null};case m.SET_LOADING:return{...e,isLoading:t.payload.isLoading};case m.SET_ERROR:return{...e,error:t.payload.error,isLoading:!1};case m.LOAD_WORKSPACES:return{...e,workspaces:t.payload.workspaces,isLoading:!1};case m.CREATE_WORKSPACE:let p={id:t.payload.id,name:t.payload.name,description:t.payload.description||"",clientLink:t.payload.clientLink||"",createdAt:t.payload.createdAt,updatedAt:t.payload.updatedAt};return{...e,workspaces:[...e.workspaces,p],currentWorkspace:p};case m.SELECT_WORKSPACE:return{...e,currentWorkspace:t.payload.workspace,files:[],sections:{},selectedFile:null,selectedSection:null};case m.LOAD_FILES:return{...e,files:t.payload.files,isLoading:!1};case m.ADD_FILE:let h=t.payload;return{...e,files:[...e.files,h],selectedFile:h};case m.SELECT_FILE:return{...e,selectedFile:t.payload.file,selectedSection:null};case m.ADD_SECTION:let y=(0,r.Z)(),x={id:y,fileId:t.payload.fileId,title:t.payload.title||"Section ".concat(Object.keys(e.sections).length+1),content:t.payload.content||"",workflowState:d.DRAFT,order:t.payload.order||Object.keys(e.sections).length,createdAt:new Date().toISOString(),comments:[],approvals:[]},g=e.files.map(e=>e.id===t.payload.fileId?{...e,sections:[...e.sections,y]}:e);return{...e,sections:{...e.sections,[y]:x},files:g,selectedSection:x};case m.UPDATE_SECTION:return{...e,sections:{...e.sections,[t.payload.sectionId]:{...e.sections[t.payload.sectionId],...t.payload.updates,updatedAt:new Date().toISOString()}}};case m.REORDER_SECTIONS:let v={...e.sections};return t.payload.newOrder.forEach((e,t)=>{v[e]&&(v[e].order=t)}),{...e,sections:v};case m.ADD_COMMENT:let f=(0,r.Z)(),w={id:f,sectionId:t.payload.sectionId,author:t.payload.author,content:t.payload.content,createdAt:new Date().toISOString(),resolved:!1};return{...e,sections:{...e.sections,[t.payload.sectionId]:{...e.sections[t.payload.sectionId],comments:[...e.sections[t.payload.sectionId].comments,f]}},comments:{...e.comments,[f]:w}};case m.UPDATE_WORKFLOW_STATE:return{...e,sections:{...e.sections,[t.payload.sectionId]:{...e.sections[t.payload.sectionId],workflowState:t.payload.newState,updatedAt:new Date().toISOString()}}};case m.ADD_ACTIVITY:let k={id:(0,r.Z)(),type:t.payload.type,description:t.payload.description,user:t.payload.user,timestamp:new Date().toISOString(),metadata:t.payload.metadata||{}};return{...e,activities:[k,...e.activities.slice(0,49)]};case m.TOGGLE_FOCUSED_VIEW:return{...e,focusedView:!e.focusedView};case m.SET_VIEW_MODE:return{...e,viewMode:t.payload};case m.DELETE_FILE:let b=e.files.filter(e=>e.id!==t.payload.fileId);return{...e,files:b,selectedFile:(null===(s=e.selectedFile)||void 0===s?void 0:s.id)===t.payload.fileId?null:e.selectedFile};case m.DELETE_WORKSPACE:let S=e.workspaces.filter(e=>e.id!==t.payload.workspaceId);return{...e,workspaces:S,currentWorkspace:(null===(a=e.currentWorkspace)||void 0===a?void 0:a.id)===t.payload.workspaceId?null:e.currentWorkspace,files:(null===(n=e.currentWorkspace)||void 0===n?void 0:n.id)===t.payload.workspaceId?[]:e.files,sections:(null===(o=e.currentWorkspace)||void 0===o?void 0:o.id)===t.payload.workspaceId?{}:e.sections,selectedFile:(null===(i=e.currentWorkspace)||void 0===i?void 0:i.id)===t.payload.workspaceId?null:e.selectedFile,selectedSection:(null===(c=e.currentWorkspace)||void 0===c?void 0:c.id)===t.payload.workspaceId?null:e.selectedSection};case m.GUEST_JOIN:return{...e,isGuest:!0,guestName:t.payload.guestName,guestWorkspaceId:t.payload.workspaceId,currentWorkspace:t.payload.workspace,isAuthenticated:!0,user:{name:t.payload.guestName,email:null,isGuest:!0}};case m.GUEST_LOGOUT:return{...u,token:null};case m.SHOW_PRICING_MODAL:return{...e,showPricingModal:!0};case m.HIDE_PRICING_MODAL:return{...e,showPricingModal:!1};case m.SHOW_CONFIRM_DIALOG:return{...e,confirmDialog:{...e.confirmDialog,...t.payload,isOpen:!0}};case m.HIDE_CONFIRM_DIALOG:return{...e,confirmDialog:{...e.confirmDialog,isOpen:!1}};case"UPDATE_COMMENT_DATA":return{...e,comments:{...e.comments,[t.payload.commentId]:t.payload.comment}};case"LOAD_SECTION_COMMENTS":return{...e,sections:{...e.sections,[t.payload.sectionId]:{...e.sections[t.payload.sectionId],comments:t.payload.comments}},comments:{...e.comments,...t.payload.commentsData}};case"UPDATE_COMMENT_RESOLVED":return{...e,comments:{...e.comments,[t.payload.commentId]:{...e.comments[t.payload.commentId],resolved:t.payload.resolved}}};case"ADD_EDIT_REQUEST":return{...e,sections:{...e.sections,[t.payload.sectionId]:{...e.sections[t.payload.sectionId],editRequests:[...(null===(l=e.sections[t.payload.sectionId])||void 0===l?void 0:l.editRequests)||[],t.payload.editRequest]}}};case"LOAD_EDIT_REQUESTS":return{...e,sections:{...e.sections,[t.payload.sectionId]:{...e.sections[t.payload.sectionId],editRequests:t.payload.editRequests}}};case"UPDATE_EDIT_REQUEST_STATUS":let E={...e.sections};return Object.keys(E).forEach(e=>{let s=E[e];s.editRequests&&(s.editRequests=s.editRequests.map(e=>e.id===t.payload.requestId?{...e,status:t.payload.status}:e))}),{...e,sections:E};default:return e}}let h=e=>{let{children:t}=e,[s,o]=(0,n.useReducer)(p,u),r={login:async(e,t)=>{o({type:m.SET_LOADING,payload:{isLoading:!0}});try{let s=await c.login(e,t);localStorage.setItem("token",s.token),o({type:m.LOGIN_SUCCESS,payload:{user:s.user,token:s.token}}),r.addActivity("user_login","Signed in as ".concat(s.user.name),s.user.name),r.loadWorkspaces()}catch(e){throw o({type:m.SET_ERROR,payload:{error:e.message}}),e}},signup:async(e,t,s)=>{o({type:m.SET_LOADING,payload:{isLoading:!0}});try{let a=await c.signup(e,t,s);localStorage.setItem("token",a.token),o({type:m.LOGIN_SUCCESS,payload:{user:a.user,token:a.token}}),r.addActivity("user_signup","Created account for ".concat(a.user.name),a.user.name),r.loadWorkspaces()}catch(e){throw o({type:m.SET_ERROR,payload:{error:e.message}}),e}},logout:async()=>{try{await c.logout()}catch(e){console.warn("Logout API call failed:",e.message)}o({type:m.LOGOUT})},initializeAuth:async()=>{let e=localStorage.getItem("token");if(console.log("initializeAuth called",{token:e?"present":"missing"}),e){var t,s;console.log("Setting loading state and calling API..."),o({type:m.SET_LOADING,payload:{isLoading:!0}});try{console.log("Making API call to getCurrentUser...");let s=await c.getCurrentUser();console.log("API call successful, user:",null===(t=s.user)||void 0===t?void 0:t.name),o({type:m.LOGIN_SUCCESS,payload:{user:s.user,token:e}}),console.log("Loading workspaces..."),await r.loadWorkspaces(),console.log("Authentication initialization complete!")}catch(e){(console.error("Token validation failed:",e),401===e.status||403===e.status||(null===(s=e.message)||void 0===s?void 0:s.includes("Invalid token")))?(console.log("Token is invalid, logging out"),localStorage.removeItem("token"),o({type:m.LOGOUT})):(console.log("Network/server error, keeping user authenticated"),o({type:m.SET_LOADING,payload:{isLoading:!1}}))}}else console.log("No token found, user needs to sign in")},loadWorkspaces:async()=>{o({type:m.SET_LOADING,payload:{isLoading:!0}});try{var e;let t=await c.getProjects(),s=((null===(e=t.projects)||void 0===e?void 0:e.owned)||[]).map(e=>({id:e.id,name:e.title,description:e.description,clientLink:e.client_link,createdAt:e.created_at,updatedAt:e.updated_at}));o({type:m.LOAD_WORKSPACES,payload:{workspaces:s}})}catch(e){o({type:m.SET_ERROR,payload:{error:e.message}})}},createWorkspace:async(e,t,s)=>{o({type:m.SET_LOADING,payload:{isLoading:!0}});try{let a=(await c.createProject({title:e,description:t,client_link:s})).project;o({type:m.CREATE_WORKSPACE,payload:{name:a.title,description:a.description,clientLink:a.client_link,id:a.id,createdAt:a.created_at,updatedAt:a.updated_at}}),r.addActivity("workspace_created",'Created workspace "'.concat(e,'"'),"You")}catch(e){var a;403===e.status&&(null===(a=e.data)||void 0===a?void 0:a.limitReached)?o({type:m.SHOW_PRICING_MODAL}):o({type:m.SET_ERROR,payload:{error:e.message}})}},selectWorkspace:async e=>{o({type:m.SELECT_WORKSPACE,payload:{workspace:e}}),r.loadFiles(e.id)},loadFiles:async e=>{o({type:m.SET_LOADING,payload:{isLoading:!0}});try{let t=(await c.getProjectFiles(e)).map(t=>({id:t.id,workspaceId:e,name:t.original_name,type:t.file_type,content:t.file_content,uploadedAt:t.created_at,workflowState:d.DRAFT,sections:[]}));o({type:m.LOAD_FILES,payload:{files:t}})}catch(e){o({type:m.SET_ERROR,payload:{error:e.message}})}},addFile:async e=>{if(!s.currentWorkspace){o({type:m.SET_ERROR,payload:{error:"Please select a workspace first"}});return}o({type:m.SET_LOADING,payload:{isLoading:!0}});try{let t=new FormData;t.append("file",e);let a=await c.uploadFile(s.currentWorkspace.id,t),n={id:a.id,workspaceId:s.currentWorkspace.id,name:a.original_name,type:a.file_type,content:a.file_content,uploadedAt:a.created_at,workflowState:d.DRAFT,sections:[]};o({type:m.ADD_FILE,payload:n}),r.addActivity("file_added",'Added file "'.concat(a.original_name,'"'),"You")}catch(e){o({type:m.SET_ERROR,payload:{error:e.message}})}},selectFile:e=>{o({type:m.SELECT_FILE,payload:{file:e}})},addSection:(e,t,s,a)=>{o({type:m.ADD_SECTION,payload:{fileId:e,title:t,content:s,order:a}}),r.addActivity("section_added",'Added section "'.concat(t,'"'),"You")},updateSection:(e,t)=>{o({type:m.UPDATE_SECTION,payload:{sectionId:e,updates:t}})},reorderSections:e=>{o({type:m.REORDER_SECTIONS,payload:{newOrder:e}}),r.addActivity("sections_reordered","Reordered sections","You")},addComment:async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"You",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"general";try{let n=await c.addSectionComment(e,{comment_text:t,comment_type:a,commenter_name:s}),i={id:n.comment.id,sectionId:e,author:n.comment.commenter_name,content:n.comment.comment_text,commentType:n.comment.comment_type,createdAt:n.comment.created_at,resolved:n.comment.is_resolved};return o({type:m.ADD_COMMENT,payload:{sectionId:e,commentId:i.id}}),o({type:"UPDATE_COMMENT_DATA",payload:{commentId:i.id,comment:i}}),r.addActivity("comment_added","Added comment to section",s),i}catch(e){throw o({type:m.SET_ERROR,payload:{error:e.message}}),e}},loadSectionComments:async e=>{try{let t=(await c.getSectionComments(e)).comments||[],s={};return t.forEach(t=>{s[t.id]={id:t.id,sectionId:e,author:t.commenter_name,content:t.comment_text,commentType:t.comment_type,createdAt:t.created_at,resolved:t.is_resolved}}),o({type:"LOAD_SECTION_COMMENTS",payload:{sectionId:e,comments:Object.keys(s),commentsData:s}}),t}catch(e){throw o({type:m.SET_ERROR,payload:{error:e.message}}),e}},resolveComment:async function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];try{await c.resolveSectionComment(e,t),o({type:"UPDATE_COMMENT_RESOLVED",payload:{commentId:e,resolved:t}}),r.addActivity("comment_resolved","".concat(t?"Resolved":"Reopened"," comment"),"You")}catch(e){throw o({type:m.SET_ERROR,payload:{error:e.message}}),e}},requestSectionEdit:async(e,t)=>{try{let s=await c.requestSectionEdit(e,{title:t.title,description:t.description,edit_type:t.editType||"content_edit",proposed_changes:t.proposedChanges,change_reason:t.reason,priority:t.priority||"normal"});return o({type:"ADD_EDIT_REQUEST",payload:{sectionId:e,editRequest:s.editRequest}}),r.addActivity("edit_requested","Requested edit for section","You"),s.editRequest}catch(e){throw o({type:m.SET_ERROR,payload:{error:e.message}}),e}},loadSectionEditRequests:async e=>{try{let t=(await c.getSectionEditRequests(e)).editRequests||[];return o({type:"LOAD_EDIT_REQUESTS",payload:{sectionId:e,editRequests:t}}),t}catch(e){throw o({type:m.SET_ERROR,payload:{error:e.message}}),e}},approveEditRequest:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{await c.updateEditRequestStatus(e,"approved",t),o({type:"UPDATE_EDIT_REQUEST_STATUS",payload:{requestId:e,status:"approved"}}),r.addActivity("edit_approved","Approved edit request","You")}catch(e){throw o({type:m.SET_ERROR,payload:{error:e.message}}),e}},denyEditRequest:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{await c.updateEditRequestStatus(e,"denied",{denial_reason:t}),o({type:"UPDATE_EDIT_REQUEST_STATUS",payload:{requestId:e,status:"denied"}}),r.addActivity("edit_denied","Denied edit request","You")}catch(e){throw o({type:m.SET_ERROR,payload:{error:e.message}}),e}},updateWorkflowState:(e,t)=>{o({type:m.UPDATE_WORKFLOW_STATE,payload:{sectionId:e,newState:t}}),r.addActivity("workflow_updated","Changed state to ".concat(t),"You")},addActivity:(e,t,s)=>{o({type:m.ADD_ACTIVITY,payload:{type:e,description:t,user:s}})},toggleFocusedView:()=>{o({type:m.TOGGLE_FOCUSED_VIEW})},setViewMode:e=>{o({type:m.SET_VIEW_MODE,payload:e})},deleteFile:async e=>{try{await c.deleteFile(e),o({type:m.DELETE_FILE,payload:{fileId:e}}),r.addActivity("file_deleted","Deleted file","You")}catch(e){o({type:m.SET_ERROR,payload:{error:e.message}})}},deleteWorkspace:async e=>{try{await c.deleteProject(e),o({type:m.DELETE_WORKSPACE,payload:{workspaceId:e}}),r.addActivity("workspace_deleted","Deleted workspace","You")}catch(e){o({type:m.SET_ERROR,payload:{error:e.message}})}},generateGuestLink:e=>{let t=btoa("".concat(e,":").concat(Date.now(),":").concat(Math.random())),s="".concat(window.location.origin,"/guest/").concat(t);navigator.clipboard.writeText(s).then(()=>{r.showConfirmDialog({message:"Guest link copied to clipboard!\n\n".concat(s,"\n\nShare this link with external collaborators. They can join without creating an account."),confirmText:"Got it",showCancel:!1})}).catch(()=>{r.showConfirmDialog({message:"Guest link generated:\n\n".concat(s,"\n\nShare this link with external collaborators. They can join without creating an account."),confirmText:"Got it",showCancel:!1})}),r.addActivity("guest_link_generated","Generated guest collaboration link","You")},joinAsGuest:async(e,t,s)=>{try{let e={id:s,name:"Guest Workspace",description:"Collaborating as guest",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};o({type:m.GUEST_JOIN,payload:{guestName:t,workspaceId:s,workspace:e}}),r.addActivity("guest_joined","".concat(t," joined as guest collaborator"),t),o({type:m.LOAD_FILES,payload:{files:[]}})}catch(e){throw o({type:m.SET_ERROR,payload:{error:e.message}}),e}},guestLogout:()=>{o({type:m.GUEST_LOGOUT})},upgradeGuestToAccount:async(e,t,a)=>{if(!s.isGuest)throw Error("Only guest users can upgrade to an account");let n={guestName:s.guestName,workspace:s.currentWorkspace,files:s.files,sections:s.sections,comments:s.comments,activities:s.activities};try{let s=await c.signup(e,t,a);return localStorage.setItem("token",s.token),o({type:m.LOGIN_SUCCESS,payload:{user:s.user,token:s.token}}),n.workspace&&o({type:m.SELECT_WORKSPACE,payload:{workspace:n.workspace}}),n.files.length>0&&o({type:m.LOAD_FILES,payload:{files:n.files}}),r.addActivity("guest_upgraded","".concat(n.guestName," upgraded to account: ").concat(s.user.name),s.user.name),await r.loadWorkspaces(),s}catch(e){throw o({type:m.SET_ERROR,payload:{error:e.message}}),e}},showPricingModal:()=>{o({type:m.SHOW_PRICING_MODAL})},hidePricingModal:()=>{o({type:m.HIDE_PRICING_MODAL})},showConfirmDialog:e=>{o({type:m.SHOW_CONFIRM_DIALOG,payload:e})},hideConfirmDialog:()=>{o({type:m.HIDE_CONFIRM_DIALOG})}};return(0,a.jsx)(l.Provider,{value:{state:s,actions:r,WORKFLOW_STATES:d},children:t})},y=()=>{let e=(0,n.useContext)(l);if(!e)throw Error("useWorkspace must be used within a WorkspaceProvider");return e};var x=s(429),g=s(5095),v=s(3289),f=s(8680);class w{connect(e){var t;return(null===(t=this.socket)||void 0===t?void 0:t.connected)?Promise.resolve():new Promise((t,s)=>{this.socket=(0,f.io)("https://api.swayfiles.com",{auth:{token:e},transports:["polling","websocket"],timeout:1e4,autoConnect:!0}),this.socket.on("connect",()=>{console.log("✅ Real-time collaboration connected"),this.isConnected=!0,this.reconnectAttempts=0,this.notifyConnectionListeners("connected"),t()}),this.socket.on("connect_error",e=>{console.error("❌ Real-time connection failed:",e.message),this.isConnected=!1,this.notifyConnectionListeners("error",e),this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,console.log("\uD83D\uDD04 Attempting to reconnect (".concat(this.reconnectAttempts,"/").concat(this.maxReconnectAttempts,")")),setTimeout(()=>{this.isConnected||this.socket.connect()},2e3*this.reconnectAttempts)):s(e)}),this.socket.on("disconnect",e=>{console.log("\uD83D\uDD0C Real-time collaboration disconnected:",e),this.isConnected=!1,this.notifyConnectionListeners("disconnected",e)}),this.setupEventListeners()})}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null,this.isConnected=!1,this.currentWorkspace=null,this.presenceData.clear(),this.activeCursors.clear(),this.typingUsers.clear())}setupEventListeners(){this.socket&&(this.socket.on("workspace-state",e=>{this.handleWorkspaceState(e)}),this.socket.on("user-joined",e=>{this.handleUserJoined(e)}),this.socket.on("user-left",e=>{this.handleUserLeft(e)}),this.socket.on("presence-updated",e=>{this.handlePresenceUpdated(e)}),this.socket.on("block-updated",e=>{this.handleBlockUpdated(e)}),this.socket.on("cursor-moved",e=>{this.handleCursorMoved(e)}),this.socket.on("user-typing",e=>{this.handleUserTyping(e)}),this.socket.on("comment-added",e=>{this.handleCommentAdded(e)}),this.socket.on("workflow-state-changed",e=>{this.handleWorkflowStateChanged(e)}),this.socket.on("notification",e=>{this.handleRealtimeNotification(e)}),this.socket.on("error",e=>{console.error("Socket error:",e),this.emit("error",e)}))}joinWorkspace(e,t){var s;if(!(null===(s=this.socket)||void 0===s?void 0:s.connected)){console.warn("Cannot join workspace: not connected");return}this.currentWorkspace=e,this.socket.emit("join-workspace",{workspaceId:e,projectId:t})}leaveWorkspace(){var e;(null===(e=this.socket)||void 0===e?void 0:e.connected)&&this.currentWorkspace&&(this.socket.emit("leave-workspace",{workspaceId:this.currentWorkspace}),this.currentWorkspace=null,this.presenceData.clear(),this.activeCursors.clear(),this.typingUsers.clear())}updateBlock(e,t,s){var a;(null===(a=this.socket)||void 0===a?void 0:a.connected)&&this.currentWorkspace&&this.socket.emit("block-update",{blockId:e,content:t,type:s,workspaceId:this.currentWorkspace})}updateCursor(e,t){var s;(null===(s=this.socket)||void 0===s?void 0:s.connected)&&this.currentWorkspace&&(clearTimeout(this.cursorThrottle),this.cursorThrottle=setTimeout(()=>{this.socket.emit("cursor-update",{workspaceId:this.currentWorkspace,position:e,blockId:t})},100))}startTyping(e){var t;(null===(t=this.socket)||void 0===t?void 0:t.connected)&&this.currentWorkspace&&this.socket.emit("typing-start",{workspaceId:this.currentWorkspace,blockId:e})}stopTyping(e){var t;(null===(t=this.socket)||void 0===t?void 0:t.connected)&&this.currentWorkspace&&this.socket.emit("typing-stop",{workspaceId:this.currentWorkspace,blockId:e})}addComment(e,t){var s;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(null===(s=this.socket)||void 0===s?void 0:s.connected)&&this.currentWorkspace&&this.socket.emit("new-comment",{workspaceId:this.currentWorkspace,blockId:e,comment:t,parentCommentId:a})}changeWorkflowState(e,t,s){var a;(null===(a=this.socket)||void 0===a?void 0:a.connected)&&this.currentWorkspace&&this.socket.emit("workflow-state-change",{workspaceId:this.currentWorkspace,blockId:e,newState:t,previousState:s})}updatePresence(e,t){var s;(null===(s=this.socket)||void 0===s?void 0:s.connected)&&this.socket.emit("presence-update",{status:e,currentView:t})}handleWorkspaceState(e){console.log("\uD83D\uDCCA Workspace state received:",e),this.presenceData.clear(),e.presence&&e.presence.forEach(e=>{this.presenceData.set(e.userId,e)}),this.activeCursors.clear(),e.activeCursors&&Object.entries(e.activeCursors).forEach(e=>{let[t,s]=e;this.activeCursors.set(t,s)}),this.typingUsers.clear(),e.typingUsers&&e.typingUsers.forEach(e=>{this.typingUsers.add(e)}),this.emit("workspace-state",e)}handleUserJoined(e){console.log("\uD83D\uDC4B User joined workspace:",e.user.email),this.presenceData.set(e.userId,{userId:e.userId,user:e.user,presence:e.presence}),this.emit("user-joined",e)}handleUserLeft(e){console.log("\uD83D\uDC4B User left workspace:",e.userId),this.presenceData.delete(e.userId),this.activeCursors.delete(e.userId),this.typingUsers.delete(e.userId),this.emit("user-left",e)}handlePresenceUpdated(e){let t=this.presenceData.get(e.userId);t&&(t.presence=e.presence),this.emit("presence-updated",e)}handleBlockUpdated(e){console.log("\uD83D\uDCDD Block ".concat(e.blockId," updated by ").concat(e.updatedBy.email)),this.emit("block-updated",e)}handleCursorMoved(e){this.activeCursors.set(e.userId,e),this.emit("cursor-moved",e)}handleUserTyping(e){e.typing?this.typingUsers.add(e.userId):this.typingUsers.delete(e.userId),this.emit("user-typing",e)}handleCommentAdded(e){console.log("\uD83D\uDCAC New comment on block ".concat(e.blockId," by ").concat(e.addedBy.email)),this.emit("comment-added",e)}handleWorkflowStateChanged(e){console.log("\uD83D\uDD04 Workflow state changed for block ".concat(e.blockId,": ").concat(e.previousState," → ").concat(e.newState)),this.emit("workflow-state-changed",e)}handleRealtimeNotification(e){console.log("\uD83D\uDD14 Real-time notification:",e),this.emit("notification",e)}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>{let s=this.listeners.get(e);s&&s.delete(t)}}off(e,t){let s=this.listeners.get(e);s&&s.delete(t)}emit(e,t){let s=this.listeners.get(e);s&&s.forEach(s=>{try{s(t)}catch(t){console.error("Error in ".concat(e," listener:"),t)}})}onConnectionChange(e){return this.connectionListeners.add(e),()=>this.connectionListeners.delete(e)}notifyConnectionListeners(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.connectionListeners.forEach(s=>{try{s(e,t)}catch(e){console.error("Error in connection listener:",e)}})}getPresenceData(){return Array.from(this.presenceData.values())}getActiveCursors(){return Array.from(this.activeCursors.values())}getTypingUsers(){return Array.from(this.typingUsers)}isUserTyping(e){return this.typingUsers.has(e)}getUserPresence(e){return this.presenceData.get(e)}getUserCursor(e){return this.activeCursors.get(e)}getConnectionStatus(){return{connected:this.isConnected,workspace:this.currentWorkspace,reconnectAttempts:this.reconnectAttempts}}constructor(){this.socket=null,this.isConnected=!1,this.currentWorkspace=null,this.listeners=new Map,this.presenceData=new Map,this.activeCursors=new Map,this.typingUsers=new Set,this.connectionListeners=new Set,this.reconnectAttempts=0,this.maxReconnectAttempts=5}}let k=new w;var b=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],[t,s]=(0,n.useState)(!1),[a,o]=(0,n.useState)("disconnected"),[r,i]=(0,n.useState)([]),[c,l]=(0,n.useState)([]),[d,u]=(0,n.useState)([]),[m,p]=(0,n.useState)(null),[h,y]=(0,n.useState)(null),x=(0,n.useRef)(null),g=(0,n.useCallback)(async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication token not found");await k.connect(e),s(!0),o("connected"),p(null)}catch(e){p(e.message),s(!1),o("error")}},[]),v=(0,n.useCallback)(()=>{k.disconnect(),s(!1),o("disconnected"),y(null),i([]),l([]),u([])},[]),f=(0,n.useCallback)((e,s)=>{if(!t){console.warn("Cannot join workspace: not connected");return}k.joinWorkspace(e,s),y(e)},[t]),w=(0,n.useCallback)(()=>{k.leaveWorkspace(),y(null),i([]),l([]),u([])},[]);(0,n.useEffect)(()=>{let t=[],a=k.onConnectionChange((t,a)=>{o(t),s("connected"===t),"error"===t?p((null==a?void 0:a.message)||"Connection error"):"connected"===t&&p(null),"disconnected"===t&&(x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{e&&g()},3e3))});t.push(a);let n=k.on("workspace-state",e=>{i(k.getPresenceData()),l(k.getActiveCursors()),u(k.getTypingUsers())});t.push(n);let r=k.on("user-joined",()=>{i(k.getPresenceData())});t.push(r);let c=k.on("user-left",()=>{i(k.getPresenceData()),l(k.getActiveCursors()),u(k.getTypingUsers())});t.push(c);let d=k.on("presence-updated",()=>{i(k.getPresenceData())});t.push(d);let m=k.on("cursor-moved",()=>{l(k.getActiveCursors())});t.push(m);let h=k.on("user-typing",()=>{u(k.getTypingUsers())});return t.push(h),e&&g(),()=>{t.forEach(e=>e()),x.current&&clearTimeout(x.current)}},[g,e]);let b=(0,n.useCallback)((e,t,s)=>{k.updateBlock(e,t,s)},[]),S=(0,n.useCallback)((e,t)=>{k.updateCursor(e,t)},[]),E=(0,n.useCallback)(e=>{k.startTyping(e)},[]),_=(0,n.useCallback)(e=>{k.stopTyping(e)},[]),D=(0,n.useCallback)((e,t,s)=>{k.addComment(e,t,s)},[]);return{isConnected:t,connectionStatus:a,error:m,currentWorkspace:h,connect:g,disconnect:v,joinWorkspace:f,leaveWorkspace:w,presenceData:r,activeCursors:c,typingUsers:d,updateBlock:b,updateCursor:S,startTyping:E,stopTyping:_,addComment:D,changeWorkflowState:(0,n.useCallback)((e,t,s)=>{k.changeWorkflowState(e,t,s)},[]),updatePresence:(0,n.useCallback)((e,t)=>{k.updatePresence(e,t)},[]),subscribe:(0,n.useCallback)((e,t)=>k.on(e,t),[]),service:k}};let S=e=>{var t,s,o;let{section:r,onSelect:i,isSelected:c,onUpdate:l,onComment:d,onApprove:u,realtimeData:m}=e,[p,h]=(0,n.useState)(!1),[y,g]=(0,n.useState)(r.content||""),[v,f]=(0,n.useState)(r.title||""),w=(0,n.useRef)(null);(0,n.useRef)(null);let k=(null==m?void 0:null===(t=m.activeCursors)||void 0===t?void 0:t.filter(e=>e.blockId===r.id))||[],b=(null==m?void 0:null===(s=m.typingUsers)||void 0===s?void 0:s.filter(e=>{var t;return(null==m?void 0:null===(t=m.typingOnBlock)||void 0===t?void 0:t[e])===r.id}))||[];null==m||m.presenceData;let S=()=>{l(r.id,{title:v,content:y}),h(!1),(null==m?void 0:m.updateBlock)&&m.updateBlock(r.id,y,"content"),(null==m?void 0:m.stopTyping)&&m.stopTyping(r.id)},E=()=>{g(r.content||""),f(r.title||""),h(!1),(null==m?void 0:m.stopTyping)&&m.stopTyping(r.id)};return(0,a.jsxs)(x.E.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},onClick:()=>i(r),className:"\n        relative border-2 rounded-lg p-4 mb-4 cursor-pointer transition-all\n        hover:border-terminal-text/50\n        ".concat(c?"border-terminal-text bg-terminal-accent/20":(e=>{let t={draft:"border-gray-500 bg-gray-900/50",under_review:"border-yellow-500 bg-yellow-900/20",changes_requested:"border-red-500 bg-red-900/20",approved:"border-green-500 bg-green-900/20",delivered:"border-blue-500 bg-blue-900/20"};return t[e]||t.draft})(r.workflowState),"\n      "),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(b.length>0?"bg-yellow-400 animate-pulse":"bg-terminal-text opacity-60")}),p?(0,a.jsx)("input",{value:v,onChange:e=>f(e.target.value),className:"bg-transparent text-terminal-text font-medium border-b border-terminal-border focus:outline-none focus:border-terminal-text",placeholder:"Block title..."}):(0,a.jsx)("h3",{className:"text-terminal-text font-medium",children:r.title})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-xs text-terminal-muted bg-terminal-surface px-2 py-1 rounded",children:{draft:"Draft",under_review:"Under Review",changes_requested:"Changes Requested",approved:"Approved",delivered:"Delivered"}[o=r.workflowState]||o}),r.comments&&r.comments.length>0&&(0,a.jsxs)("span",{className:"text-xs bg-yellow-500/20 text-yellow-400 px-2 py-1 rounded",children:[r.comments.length," comment",r.comments.length>1?"s":""]}),b.length>0&&(0,a.jsxs)("span",{className:"text-xs bg-yellow-500/20 text-yellow-400 px-2 py-1 rounded flex items-center",children:[(0,a.jsx)("div",{className:"w-1 h-1 bg-yellow-400 rounded-full animate-pulse mr-1"}),b.length," typing..."]}),k.length>0&&(0,a.jsxs)("span",{className:"text-xs bg-blue-500/20 text-blue-400 px-2 py-1 rounded",children:[k.length," active"]})]})]}),(0,a.jsx)("div",{className:"mb-3 relative",children:p?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("textarea",{ref:w,value:y,onChange:e=>{if(g(e.target.value),null==m?void 0:m.updateCursor){let t=e.target.selectionStart;m.updateCursor(t,r.id)}},onFocus:()=>{(null==m?void 0:m.startTyping)&&m.startTyping(r.id)},onBlur:()=>{(null==m?void 0:m.stopTyping)&&m.stopTyping(r.id)},className:"w-full h-32 bg-terminal-surface border border-terminal-border rounded p-3 text-terminal-text text-sm focus:outline-none focus:border-terminal-text resize-none",placeholder:"Block content..."}),k.map(e=>(0,a.jsx)("div",{className:"absolute bg-blue-400 h-4 w-0.5 pointer-events-none z-10",style:{left:"".concat(Math.min(8*e.position+12,90),"%"),top:"12px"}},e.userId))]}):(0,a.jsx)("div",{className:"text-terminal-text text-sm whitespace-pre-wrap min-h-16",children:r.content||(0,a.jsx)("span",{className:"text-terminal-muted italic",children:"Empty block - click to add content"})})}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex items-center space-x-2",children:p?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),S()},className:"text-xs bg-terminal-text text-terminal-bg px-3 py-1 rounded hover:bg-terminal-text/90",children:"Save"}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),E()},className:"text-xs border border-terminal-border text-terminal-text px-3 py-1 rounded hover:bg-terminal-accent",children:"Cancel"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),h(!0)},className:"text-xs text-terminal-muted hover:text-terminal-text",children:"✏️ Edit"}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),d(r.id)},className:"text-xs text-terminal-muted hover:text-terminal-text",children:"\uD83D\uDCAC Comment"}),"draft"===r.workflowState&&(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),u(r.id)},className:"text-xs text-green-400 hover:text-green-300",children:"✓ Submit for Review"}),"under_review"===r.workflowState&&(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),u(r.id)},className:"text-xs text-green-400 hover:text-green-300",children:"✓ Approve"})]})}),(0,a.jsx)("div",{className:"text-xs text-terminal-muted",children:r.createdAt&&new Date(r.createdAt).toLocaleDateString()})]}),(0,a.jsx)("div",{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-terminal-muted hover:text-terminal-text cursor-grab",children:(0,a.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,a.jsx)("div",{className:"w-1 h-1 bg-current rounded-full"}),(0,a.jsx)("div",{className:"w-1 h-1 bg-current rounded-full"}),(0,a.jsx)("div",{className:"w-1 h-1 bg-current rounded-full"}),(0,a.jsx)("div",{className:"w-1 h-1 bg-current rounded-full"}),(0,a.jsx)("div",{className:"w-1 h-1 bg-current rounded-full"}),(0,a.jsx)("div",{className:"w-1 h-1 bg-current rounded-full"})]})})]})};var E=e=>{let{projectId:t,selectedSection:s,onSectionSelect:o}=e,{state:r,actions:i,WORKFLOW_STATES:c}=y(),{showNotification:l}=(0,v.Z)(),[d,u]=(0,n.useState)(!1),[m,p]=(0,n.useState)(""),h=b(!0);(0,n.useEffect)(()=>(t&&h.isConnected&&h.joinWorkspace(t,t),()=>{h.isConnected&&h.leaveWorkspace()}),[t,h.isConnected]),(0,n.useEffect)(()=>{let e=[],t=h.subscribe("block-updated",e=>{var t;i.updateSection(e.blockId,{content:e.content}),(null===(t=e.updatedBy)||void 0===t?void 0:t.name)&&l("block_updated","Block Updated","".concat(e.updatedBy.name,' updated "').concat(e.blockId,'"'))});e.push(t);let s=h.subscribe("comment-added",e=>{l("comment_added","New Comment","".concat(e.addedBy.name," commented on a block"))});e.push(s);let a=h.subscribe("workflow-state-changed",e=>{i.updateWorkflowState(e.blockId,e.newState),l("workflow_changed","Workflow Updated","".concat(e.changedBy.name," changed block state to ").concat(e.newState))});return e.push(a),()=>{e.forEach(e=>e())}},[h,i,l]),(0,n.useEffect)(()=>{var e;if(t&&(null===(e=r.currentWorkspace)||void 0===e?void 0:e.id)!==t){let e=r.workspaces.find(e=>e.id===t);e&&i.selectWorkspace(e)}},[t,r.workspaces,r.currentWorkspace]),(0,n.useEffect)(()=>{let e=e=>{"/"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),u(!0)),"Escape"===e.key&&(u(!1),p(""),null==o||o(null))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);let f=async()=>{var e,t;if((!r.currentWorkspace||!r.selectedFile)&&!r.selectedFile&&0===r.files.length){let e=new File([""],"workspace.md",{type:"text/markdown"});await i.addFile(e)}let s=(null===(e=r.selectedFile)||void 0===e?void 0:e.id)||(null===(t=r.files[0])||void 0===t?void 0:t.id);s&&i.addSection(s,"New Block","",Object.keys(r.sections).length)},w=(e,t)=>{i.updateSection(e,t)},k=async e=>{let t=prompt("Add a comment:");t&&t.trim()&&(await i.addComment(e,t.trim()),l("review_comment_added","Comment Added",'Added comment: "'.concat(t.substring(0,50)).concat(t.length>50?"...":"",'"')))},E=e=>{let t=r.sections[e];t&&("draft"===t.workflowState?(i.updateWorkflowState(e,c.UNDER_REVIEW),l("review_assigned","Submitted for Review",'"'.concat(t.title,'" has been submitted for review'))):"under_review"===t.workflowState&&(i.updateWorkflowState(e,c.APPROVED),l("review_approved","Block Approved",'"'.concat(t.title,'" has been approved!'))))},_=()=>{let e=m.toLowerCase().trim();e.startsWith("/new")||"/block"===e?f():e.startsWith("/comment")?s&&k(s.id):e.startsWith("/approve")&&s&&E(s.id),u(!1),p("")},D={presenceData:h.presenceData,activeCursors:h.activeCursors,typingUsers:h.typingUsers,updateBlock:h.updateBlock,updateCursor:h.updateCursor,startTyping:h.startTyping,stopTyping:h.stopTyping,typingOnBlock:{}},C=Object.values(r.sections).filter(e=>!r.selectedFile||e.fileId===r.selectedFile.id).sort((e,t)=>(e.order||0)-(t.order||0));return r.isLoading?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("div",{className:"text-terminal-muted",children:"Loading workspace..."})}):r.error?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"text-red-400",children:["Error: ",r.error]})}):r.currentWorkspace?(0,a.jsxs)("div",{className:"h-full bg-terminal-bg relative",children:[(0,a.jsx)("div",{className:"border-b border-terminal-border bg-terminal-surface p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("h1",{className:"text-xl text-terminal-text font-medium",children:r.currentWorkspace.name}),r.currentWorkspace.description&&(0,a.jsx)("span",{className:"text-terminal-muted text-sm",children:r.currentWorkspace.description}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(h.isConnected?"bg-green-400":"bg-red-400")}),(0,a.jsx)("span",{className:"text-xs text-terminal-muted",children:h.isConnected?"Live":"Disconnected"})]}),h.presenceData.length>0&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("div",{className:"flex -space-x-1",children:[h.presenceData.slice(0,3).map((e,t)=>{var s,n,o,r;return(0,a.jsx)("div",{className:"w-6 h-6 bg-blue-500 rounded-full border-2 border-terminal-surface flex items-center justify-center text-xs text-white font-medium",title:(null===(s=e.user)||void 0===s?void 0:s.name)||(null===(n=e.user)||void 0===n?void 0:n.email),children:((null===(o=e.user)||void 0===o?void 0:o.name)||(null===(r=e.user)||void 0===r?void 0:r.email)||"U").charAt(0).toUpperCase()},e.userId)}),h.presenceData.length>3&&(0,a.jsxs)("div",{className:"w-6 h-6 bg-terminal-muted rounded-full border-2 border-terminal-surface flex items-center justify-center text-xs text-terminal-bg",children:["+",h.presenceData.length-3]})]}),(0,a.jsxs)("span",{className:"text-xs text-terminal-muted",children:[h.presenceData.length," online"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("button",{onClick:f,className:"bg-terminal-text text-terminal-bg px-4 py-2 text-sm rounded hover:bg-terminal-text/90",children:"+ New Block"}),(0,a.jsx)("button",{onClick:()=>u(!0),className:"text-terminal-muted hover:text-terminal-text text-sm",children:"⌘ /"})]})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-auto p-6",children:0===C.length?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-6xl text-terminal-muted mb-4",children:"◇"}),(0,a.jsx)("h2",{className:"text-terminal-text text-lg mb-2",children:"Start building your workspace"}),(0,a.jsx)("p",{className:"text-terminal-muted text-sm mb-6",children:"Create blocks to organize your content, code, tasks, and ideas"}),(0,a.jsx)("button",{onClick:f,className:"bg-terminal-text text-terminal-bg px-6 py-3 rounded hover:bg-terminal-text/90",children:"Create Your First Block"}),(0,a.jsx)("div",{className:"mt-4 text-xs text-terminal-muted",children:"Press ⌘ + / to open command palette"})]})}):(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsx)(g.M,{children:C.map(e=>(0,a.jsx)(S,{section:e,isSelected:(null==s?void 0:s.id)===e.id,onSelect:o,onUpdate:w,onComment:k,onApprove:E,realtimeData:D},e.id))})})}),(0,a.jsx)(g.M,{children:d&&(0,a.jsx)(x.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-start justify-center pt-20 z-50",onClick:()=>u(!1),children:(0,a.jsxs)(x.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-terminal-surface border border-terminal-border rounded-lg p-4 w-96 max-w-full",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsx)("input",{value:m,onChange:e=>p(e.target.value),onKeyDown:e=>{"Enter"===e.key&&_(),"Escape"===e.key&&u(!1)},className:"w-full bg-terminal-bg border border-terminal-border rounded px-3 py-2 text-terminal-text focus:outline-none focus:border-terminal-text",placeholder:"Type a command...",autoFocus:!0})}),(0,a.jsxs)("div",{className:"text-xs text-terminal-muted space-y-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-terminal-text",children:"/new"})," - Create new block"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-terminal-text",children:"/comment"})," - Add comment to selected block"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-terminal-text",children:"/approve"})," - Approve selected block"]})]})]})})})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-terminal-muted mb-4",children:"No workspace selected"}),(0,a.jsx)("button",{onClick:()=>window.location.href="/dashboard",className:"text-terminal-text border border-terminal-border px-4 py-2 rounded hover:bg-terminal-accent",children:"Go to Dashboard"})]})})};let _=e=>{var t;let{onFileSelect:s,onWorkspaceSelect:o}=e,{state:r,actions:i}=y(),[c,l]=(0,n.useState)(new Set([null===(t=r.currentWorkspace)||void 0===t?void 0:t.id])),d=e=>{let t=new Set(c);t.has(e)?t.delete(e):t.add(e),l(t)},u=async e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s)try{await i.addFile(s)}catch(e){console.error("Failed to upload file:",e)}};return(0,a.jsxs)("div",{className:"w-80 bg-terminal-surface border-r border-terminal-border h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-terminal-border",children:[(0,a.jsx)("h2",{className:"text-terminal-text font-medium mb-3",children:"Workspaces"}),(0,a.jsx)("button",{onClick:()=>i.createWorkspace("New Workspace","",""),className:"w-full text-left text-sm text-terminal-muted hover:text-terminal-text hover:bg-terminal-accent p-2 rounded transition-colors",children:"+ New Workspace"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-auto",children:r.workspaces.map(e=>{var t,n,o,i;return(0,a.jsxs)("div",{className:"border-b border-terminal-border/50",children:[(0,a.jsxs)("button",{onClick:()=>d(e.id),className:"\n                w-full text-left p-3 hover:bg-terminal-accent transition-colors flex items-center justify-between\n                ".concat((null===(t=r.currentWorkspace)||void 0===t?void 0:t.id)===e.id?"bg-terminal-accent text-terminal-text":"text-terminal-muted hover:text-terminal-text","\n              "),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-xs transition-transform ".concat(c.has(e.id)?"rotate-90":""),children:"▶"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:e.name})]}),(null===(n=r.currentWorkspace)||void 0===n?void 0:n.id)===e.id&&(0,a.jsx)("div",{className:"w-2 h-2 bg-terminal-text rounded-full"})]}),(0,a.jsx)(g.M,{children:c.has(e.id)&&(0,a.jsx)(x.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:(0,a.jsxs)("div",{className:"pl-6 pb-2",children:[(null===(o=r.currentWorkspace)||void 0===o?void 0:o.id)===e.id&&r.files.map(e=>{var t;return(0,a.jsx)("button",{onClick:()=>s(e),className:"\n                          block w-full text-left p-2 text-xs rounded transition-colors\n                          ".concat((null===(t=r.selectedFile)||void 0===t?void 0:t.id)===e.id?"bg-terminal-text text-terminal-bg":"text-terminal-muted hover:text-terminal-text hover:bg-terminal-accent","\n                        "),children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{children:"\uD83D\uDCC4"}),(0,a.jsx)("span",{children:e.name})]})},e.id)}),(null===(i=r.currentWorkspace)||void 0===i?void 0:i.id)===e.id&&(0,a.jsxs)("label",{className:"block w-full text-left p-2 text-xs text-terminal-muted hover:text-terminal-text cursor-pointer",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{children:"+"}),(0,a.jsx)("span",{children:"Add file"})]}),(0,a.jsx)("input",{type:"file",onChange:u,className:"hidden",accept:".md,.txt,.js,.jsx,.ts,.tsx,.py,.css,.html,.json"})]})]})})})]},e.id)})}),(0,a.jsx)("div",{className:"p-4 border-t border-terminal-border",children:(0,a.jsxs)("div",{className:"text-xs text-terminal-muted",children:[(0,a.jsx)("div",{children:"Press ⌘ + / for commands"}),(0,a.jsxs)("div",{className:"mt-1",children:[r.files.length," file",1!==r.files.length?"s":""," •",Object.keys(r.sections).length," block",1!==Object.keys(r.sections).length?"s":""]})]})})]})},D=e=>{var t,s;let{selectedSection:o}=e,{state:r,actions:i}=y(),[c,l]=(0,n.useState)("comments"),[d,u]=(0,n.useState)(""),m=async()=>{if(d.trim()&&o)try{await i.addComment(o.id,d.trim()),u("")}catch(e){console.error("Failed to add comment:",e)}},p=()=>{var e;return o&&(null===(e=o.comments)||void 0===e?void 0:e.map(e=>r.comments[e]).filter(Boolean))||[]},h=()=>r.activities.slice(0,10);return(0,a.jsxs)("div",{className:"w-80 bg-terminal-surface border-l border-terminal-border h-full flex flex-col",children:[(0,a.jsx)("div",{className:"border-b border-terminal-border",children:(0,a.jsx)("div",{className:"flex",children:[{id:"comments",label:"Comments",icon:"\uD83D\uDCAC"},{id:"activity",label:"Activity",icon:"\uD83D\uDCCB"},{id:"inspector",label:"Inspector",icon:"\uD83D\uDD0D"}].map(e=>(0,a.jsxs)("button",{onClick:()=>l(e.id),className:"\n                flex-1 p-3 text-sm border-b-2 transition-colors\n                ".concat(c===e.id?"border-terminal-text text-terminal-text bg-terminal-accent/20":"border-transparent text-terminal-muted hover:text-terminal-text","\n              "),children:[(0,a.jsx)("span",{className:"mr-1",children:e.icon}),e.label]},e.id))})}),(0,a.jsxs)("div",{className:"flex-1 overflow-auto",children:["comments"===c&&(0,a.jsx)("div",{className:"p-4",children:o?(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("h3",{className:"text-sm font-medium text-terminal-text mb-2",children:["Comments on: ",o.title]}),(0,a.jsx)("div",{className:"space-y-3 mb-4",children:p().length>0?p().map(e=>(0,a.jsxs)("div",{className:"bg-terminal-accent rounded p-3",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-terminal-text",children:e.author}),(0,a.jsx)("span",{className:"text-xs text-terminal-muted",children:new Date(e.createdAt).toLocaleString()})]}),(0,a.jsx)("p",{className:"text-sm text-terminal-text",children:e.content}),e.resolved&&(0,a.jsx)("span",{className:"inline-block mt-2 text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded",children:"Resolved"})]},e.id)):(0,a.jsx)("div",{className:"text-center py-8 text-terminal-muted text-sm",children:"No comments yet"})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("textarea",{value:d,onChange:e=>u(e.target.value),placeholder:"Add a comment...",className:"w-full h-20 bg-terminal-bg border border-terminal-border rounded p-2 text-sm text-terminal-text resize-none focus:outline-none focus:border-terminal-text"}),(0,a.jsx)("button",{onClick:m,disabled:!d.trim(),className:"w-full bg-terminal-text text-terminal-bg py-2 text-sm rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-terminal-text/90",children:"Add Comment"})]})]})}):(0,a.jsx)("div",{className:"text-center py-8 text-terminal-muted text-sm",children:"Select a block to view comments"})}),"activity"===c&&(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-terminal-text mb-3",children:"Recent Activity"}),(0,a.jsx)("div",{className:"space-y-3",children:h().length>0?h().map(e=>(0,a.jsxs)("div",{className:"border-l-2 border-terminal-border pl-3",children:[(0,a.jsx)("div",{className:"text-xs text-terminal-muted mb-1",children:new Date(e.timestamp).toLocaleString()}),(0,a.jsxs)("div",{className:"text-sm text-terminal-text",children:[(0,a.jsx)("span",{className:"font-medium",children:e.user})," ",e.description]})]},e.id)):(0,a.jsx)("div",{className:"text-center py-8 text-terminal-muted text-sm",children:"No activity yet"})})]}),"inspector"===c&&(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-terminal-text mb-3",children:"Inspector"}),o?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-terminal-muted",children:"Block ID"}),(0,a.jsx)("div",{className:"text-sm text-terminal-text font-mono bg-terminal-accent rounded p-2 mt-1",children:o.id})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-terminal-muted",children:"Workflow State"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsxs)("select",{value:o.workflowState,onChange:e=>i.updateWorkflowState(o.id,e.target.value),className:"w-full bg-terminal-bg border border-terminal-border rounded p-2 text-sm text-terminal-text focus:outline-none focus:border-terminal-text",children:[(0,a.jsx)("option",{value:"draft",children:"Draft"}),(0,a.jsx)("option",{value:"under_review",children:"Under Review"}),(0,a.jsx)("option",{value:"changes_requested",children:"Changes Requested"}),(0,a.jsx)("option",{value:"approved",children:"Approved"}),(0,a.jsx)("option",{value:"delivered",children:"Delivered"})]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-terminal-muted",children:"Created"}),(0,a.jsx)("div",{className:"text-sm text-terminal-text mt-1",children:o.createdAt?new Date(o.createdAt).toLocaleString():"Unknown"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-terminal-muted",children:"Last Updated"}),(0,a.jsx)("div",{className:"text-sm text-terminal-text mt-1",children:o.updatedAt?new Date(o.updatedAt).toLocaleString():"Never"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-terminal-muted",children:"Comments"}),(0,a.jsxs)("div",{className:"text-sm text-terminal-text mt-1",children:[(null===(t=o.comments)||void 0===t?void 0:t.length)||0," comment",(null===(s=o.comments)||void 0===s?void 0:s.length)!==1?"s":""]})]})]}):(0,a.jsx)("div",{className:"text-center py-8 text-terminal-muted text-sm",children:"Select a block to inspect"})]})]})]})};function C(){let{state:e,actions:t}=y(),s=(0,o.useSearchParams)(),[r,i]=(0,n.useState)(null),[c,l]=(0,n.useState)(!1),d=null==s?void 0:s.get("id");return((0,n.useEffect)(()=>{t.initializeAuth()},[]),(0,n.useEffect)(()=>{if(d&&e.workspaces.length>0){var s;let a=e.workspaces.find(e=>e.id===d);a&&(null===(s=e.currentWorkspace)||void 0===s?void 0:s.id)!==a.id&&t.selectWorkspace(a)}},[d,e.workspaces]),e.isAuthenticated||e.isLoading)?(0,a.jsxs)("div",{className:"h-screen bg-terminal-bg flex",children:[!c&&(0,a.jsx)(_,{onFileSelect:e=>{t.selectFile(e)},onWorkspaceSelect:e=>{t.selectWorkspace(e)}}),(0,a.jsx)("div",{className:"flex-1 flex flex-col min-w-0",children:(0,a.jsx)("div",{className:"flex-1 min-h-0",children:(0,a.jsx)(E,{projectId:d,selectedSection:r,onSectionSelect:i})})}),(0,a.jsx)(D,{selectedSection:r}),(0,a.jsx)("button",{onClick:()=>l(!c),className:"fixed left-4 top-1/2 transform -translate-y-1/2 z-10 bg-terminal-surface border border-terminal-border rounded p-2 text-terminal-muted hover:text-terminal-text",children:c?"→":"←"}),e.error&&(0,a.jsx)("div",{className:"fixed bottom-4 right-4 bg-red-900/90 border border-red-500 text-red-100 p-4 rounded max-w-md",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:"Error"}),(0,a.jsx)("div",{className:"text-sm",children:e.error})]}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"ml-4 text-red-200 hover:text-white",children:"✕"})]})}),e.isLoading&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-terminal-surface border border-terminal-border rounded-lg p-6 text-center",children:[(0,a.jsx)("div",{className:"text-terminal-text mb-2",children:"Loading..."}),(0,a.jsx)("div",{className:"text-terminal-muted text-sm",children:"Setting up your workspace"})]})})]}):(0,a.jsx)("div",{className:"h-screen flex items-center justify-center bg-terminal-bg",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-2xl text-terminal-text mb-4",children:"Please sign in"}),(0,a.jsx)("p",{className:"text-terminal-muted mb-6",children:"You need to be signed in to access workspaces."}),(0,a.jsx)("button",{onClick:()=>window.location.href="/login",className:"bg-terminal-text text-terminal-bg px-6 py-3 rounded hover:bg-terminal-text/90",children:"Go to Login"})]})})}function N(){return(0,a.jsx)(h,{children:(0,a.jsx)(C,{})})}},3289:function(e,t,s){"use strict";var a=s(2265),n=s(8378);t.Z=()=>{let[e,t]=(0,a.useState)([]),[s,o]=(0,a.useState)(0),[r,i]=(0,a.useState)(!1),[c,l]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=n.Z.subscribe(e=>{t(e.notifications),o(e.unreadCount)});return d(),e},[]);let d=async()=>{i(!0),l(null);try{await n.Z.getNotifications()}catch(e){l(e.message||"Failed to load notifications")}finally{i(!1)}};return{notifications:e,unreadCount:s,loading:r,error:c,loadNotifications:d,markAsRead:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];n.Z.markAsRead(e)},clearAll:()=>{n.Z.clearAll()},showNotification:function(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};n.Z.createLocalNotification(e,t,s,a)},startPolling:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e4;n.Z.startPolling(e)},stopPolling:()=>{n.Z.stopPolling()}}}},8378:function(e,t){"use strict";class s{async makeRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=localStorage.getItem("token"),a={headers:{"Content-Type":"application/json",...s&&{Authorization:"Bearer ".concat(s)}}},n=await fetch("".concat("https://api.swayfiles.com").concat(e),{...a,...t,headers:{...a.headers,...t.headers}});if(!n.ok)throw Error(await n.text()||"HTTP error! status: ".concat(n.status));return n.json()}async getNotifications(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{let t=await this.makeRequest("/activity/notifications".concat(e?"?since=".concat(e):""));if(t.success)return this.notifications=t.notifications||[],this.unreadCount=t.unread_count||0,this.notifyListeners(),t;return{notifications:[],unread_count:0}}catch(e){return console.error("Error fetching notifications:",e),{notifications:[],unread_count:0}}}async getActivityFeed(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let{type:t="all",limit:s=20,offset:a=0,since:n,before:o}=e,r=new URLSearchParams({type:t,limit:s.toString(),offset:a.toString()});return n&&r.append("since",n),o&&r.append("before",o),await this.makeRequest("/activity?".concat(r.toString()))}catch(e){throw console.error("Error fetching activity feed:",e),e}}markAsRead(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];0===e.length?(this.notifications=this.notifications.map(e=>({...e,read:!0})),this.unreadCount=0):(this.notifications=this.notifications.map(t=>e.includes(t.id)?{...t,read:!0}:t),this.unreadCount=Math.max(0,this.unreadCount-e.length)),this.notifyListeners()}clearAll(){this.notifications=[],this.unreadCount=0,this.notifyListeners()}startPolling(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e4;this.isPolling||(this.isPolling=!0,this.pollInterval=setInterval(()=>{this.getNotifications()},e),this.getNotifications())}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null),this.isPolling=!1}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notifyListeners(){this.listeners.forEach(e=>{e({notifications:this.notifications,unreadCount:this.unreadCount})})}getNotificationIcon(e){let t={project_created:"\uD83C\uDD95",project_shared:"\uD83D\uDCE4",project_updated:"\uD83D\uDCDD",project_completed:"✅",collaboration_created:"\uD83E\uDD1D",collaboration_invited:"\uD83D\uDC8C",collaboration_accepted:"✓",collaboration_ended:"\uD83D\uDC4B",review_assigned:"\uD83D\uDC41️",review_approved:"✅",review_rejected:"❌",review_changes_requested:"\uD83D\uDD04",team_invitation_sent:"\uD83D\uDCE8",team_invitation_accepted:"\uD83C\uDF89",team_member_removed:"➖",review_comment_added:"\uD83D\uDCAC",comment_reply:"↩️",file_uploaded:"\uD83D\uDCC1",file_request_created:"\uD83D\uDCCB",edit_request_created:"✏️",edit_request_approved:"✅",edit_started:"⚡",default:"\uD83D\uDCE2"};return t[e]||t.default}getNotificationColor(e){let t={project_completed:"text-green-400 bg-green-900/20",review_approved:"text-green-400 bg-green-900/20",collaboration_accepted:"text-green-400 bg-green-900/20",team_invitation_accepted:"text-green-400 bg-green-900/20",review_changes_requested:"text-yellow-400 bg-yellow-900/20",review_rejected:"text-yellow-400 bg-yellow-900/20",collaboration_ended:"text-red-400 bg-red-900/20",team_member_removed:"text-red-400 bg-red-900/20",default:"text-blue-400 bg-blue-900/20"};return t[e]||t.default}formatNotificationTime(e){if(!e)return"Unknown";let t=new Date,s=new Date(e),a=t-s,n=Math.floor(a/6e4),o=Math.floor(a/36e5),r=Math.floor(a/864e5);return n<1?"Just now":n<60?"".concat(n,"m ago"):o<24?"".concat(o,"h ago"):r<7?"".concat(r,"d ago"):s.toLocaleDateString()}getNotificationPriority(e){return["review_assigned","collaboration_invited","team_invitation_sent","edit_request_created","review_changes_requested"].includes(e)?"high":["review_approved","collaboration_accepted","team_invitation_accepted","comment_reply","review_comment_added"].includes(e)?"medium":"low"}createLocalNotification(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n={id:"local_".concat(Date.now()),action:e,description:s,actor_name:"You",created_at:new Date().toISOString(),resource_title:t,metadata:a,read:!1,local:!0};this.notifications.unshift(n),this.unreadCount+=1,this.notifyListeners(),setTimeout(()=>{this.notifications=this.notifications.filter(e=>e.id!==n.id),this.unreadCount=Math.max(0,this.unreadCount-1),this.notifyListeners()},5e3)}async requestNotificationPermission(){return"Notification"in window?"granted"===Notification.permission?"granted":"denied"!==Notification.permission?await Notification.requestPermission():Notification.permission:"not-supported"}showBrowserNotification(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if("granted"===Notification.permission){let n=new Notification(e,{body:t,icon:s||"/favicon.ico",tag:"swayfiles-notification"});return a&&(n.onclick=a),setTimeout(()=>n.close(),5e3),n}}constructor(){this.listeners=new Set,this.notifications=[],this.unreadCount=0,this.pollInterval=null,this.isPolling=!1}}let a=new s;t.Z=a}},function(e){e.O(0,[141,925,971,117,744],function(){return e(e.s=9144)}),_N_E=e.O()}]);